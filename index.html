<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kriuké Snack</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome Icons CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Google Font (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- PWA Manifest (tetap) -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF6B00">
    <meta name="description" content="Kriuknya Beda, Rasanya Istimewa">
    <link rel="apple-touch-icon" href="https://i.ibb.co.com/n86sQs1v/Logo-Toko-Aneka-Cemilan-Snack-Ceria-Oranye-Kuning-20251105_010226_0000.png">

    <style>
        /* Menggunakan font Inter sebagai default */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        /* Kelas untuk menyembunyikan/menampilkan halaman */
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }

        /* Sembunyikan scrollbar untuk container kategori */
        #category-filter-container::-webkit-scrollbar {
            display: none;
        }
        #category-filter-container {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        
        /* Mengatur padding bawah untuk halaman agar tidak tertutup nav bottom dan footer baru */
        #page-home main, #page-detail main, #page-liked main, #page-admin main, #page-login main, #page-edit main, #page-promo-edit main {
            /* Disesuaikan: 56px (nav bottom) + 144px (footer baru) = 200px */
            padding-bottom: 200px; 
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Notifikasi Toast -->
    <div id="toast-notification" class="fixed top-20 left-1/2 -translate-x-1/2 bg-black bg-opacity-70 text-white px-4 py-2 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 z-[100] whitespace-nowrap">
        Item ditambahkan ke keranjang!
    </div>

    <!-- Kontainer utama aplikasi -->
    <div class="max-w-md mx-auto min-h-screen bg-white shadow-lg">

        <!-- ===== HALAMAN HOME ===== -->
        <div id="page-home" class="page active">
            <!-- Header -->
            <header class="sticky top-0 z-50 bg-white shadow-md p-4">
                <div class="flex items-center justify-between mb-3">
                    <!-- Logo Kiri -->
                    <div class="flex items-center gap-2">
                        <img src="https://i.ibb.co.com/n86sQs1v/Logo-Toko-Aneka-Cemilan-Snack-Ceria-Oranye-Kuning-20251105_010226_0000.png" alt="Kriuké Snack Logo" class="h-6 w-auto">
                        <span class="text-lg font-bold text-orange-600">Kriuké</span>
                    </div>
                    
                    <!-- Cart, TikTok Live & Menu Kanan -->
                    <div class="flex items-center gap-4">
                        <!-- TikTok Live Button (BARU ICON) -->
                        <a href="https://www.tiktok.com/@kriukesnack" target="_blank" class="text-2xl hover:opacity-80 transition-opacity" aria-label="Tonton TikTok Live">
                            <!-- Menggunakan GIF yang baru -->
                            <img src="https://i.ibb.co.com/DDBwMkYK/live-9601-256.gif" alt="TikTok Live" class="w-7 h-7 object-cover rounded-full shadow-md">
                        </a>
                        <!-- Cart Icon -->
                        <button id="cart-icon-btn" class="navigate-btn text-2xl text-gray-700 relative" data-target="page-cart">
                            <i class="fa-solid fa-cart-shopping"></i>
                            <span id="cart-count-badge" class="absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center opacity-0 transition-opacity">0</span>
                        </button>
                        <!-- Menu Icon -->
                        <button id="menu-toggle-btn" class="text-2xl text-gray-700">
                            <i class="fa-solid fa-bars"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Search Bar -->
                <div class="relative">
                    <input type="text" id="search-input" class="w-full pl-10 pr-4 py-2 border border-gray-200 bg-gray-50 rounded-lg text-sm focus:ring-1 focus:ring-orange-500 focus:border-orange-500" placeholder="Cari produk...">
                    <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
            </header>

            <!-- ===== PROMO SLIDER (BARU) ===== -->
            <div id="promo-slider-container" class="relative w-full h-48 overflow-hidden bg-gray-200">
                <!-- Slide 1 -->
                <div class="promo-slide absolute inset-0 transition-opacity duration-1000 ease-in-out opacity-100">
                    <img src="https://placehold.co/400x192/FF6B00/FFFFFF?text=Promo+Kriuk+Hemat" alt="Promo 1" class="w-full h-full object-cover">
                </div>
                <!-- Slide 2 -->
                <div class="promo-slide absolute inset-0 transition-opacity duration-1000 ease-in-out opacity-0">
                    <img src="https://placehold.co/400x192/4CAF50/FFFFFF?text=Gratis+Ongkir" alt="Promo 2" class="w-full h-full object-cover">
                </div>
                <!-- Slide 3 -->
                <div class="promo-slide absolute inset-0 transition-opacity duration-1000 ease-in-out opacity-0">
                    <img src="https://placehold.co/400x192/F44336/FFFFFF?text=Diskon+Akhir+Tahun" alt="Promo 3" class="w-full h-full object-cover">
                </div>
            </div>

            <!-- Kategori Filter -->
            <div class="px-4 py-3 border-b border-gray-200">
                <div id="category-filter-container" class="flex gap-2 overflow-x-auto">
                    <!-- Kategori akan di-render oleh JavaScript -->
                </div>
            </div>

            <!-- Konten Utama -->
            <main class="pb-20">
                <!-- Product Grid (2 kolom) -->
                <div id="product-grid" class="grid grid-cols-2 gap-3 p-3">
                    <!-- Produk akan di-render oleh JavaScript di sini -->
                </div>
            </main>
        </div>

        <!-- ===== HALAMAN DETAIL PRODUK ===== -->
        <div id="page-detail" class="page">
            <header class="sticky top-0 z-50 bg-white shadow px-4 py-3 flex items-center">
                <button class="navigate-btn text-xl" data-target="page-home">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h2 class="text-lg font-semibold ml-4">Detail Produk</h2>
            </header>
            
            <main id="detail-content" class="pb-20"> 
                <!-- Detail akan di-render oleh JavaScript di sini -->
            </main>
        </div>
        
        <!-- ===== HALAMAN WHITELIST / FAVORIT ===== -->
        <div id="page-liked" class="page">
            <header class="sticky top-0 z-50 bg-white shadow px-4 py-3 flex items-center">
                <button class="navigate-btn text-xl" data-target="page-home">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h2 class="text-lg font-semibold ml-4">Whitelist Produk Favorit</h2>
            </header>
            <main id="liked-items-container" class="p-4 pb-20 grid grid-cols-2 gap-3">
                <!-- Produk favorit akan di-render di sini oleh JavaScript -->
            </main>
        </div>

        <!-- ===== HALAMAN KERANJANG ===== -->
        <div id="page-cart" class="page">
            <header class="sticky top-0 z-50 bg-white shadow px-4 py-3 flex items-center">
                <button class="navigate-btn text-xl" data-target="page-home">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h2 class="text-lg font-semibold ml-4">Keranjang Saya</h2>
            </header>
            <main id="cart-items-container" class="p-4 pb-40">
                <!-- Item keranjang akan di-render di sini -->
            </main>
            
            <!-- FOOTER KERANJANG (DIPERBARUI) -->
            <footer class="fixed bottom-16 left-1/2 -translate-x-1/2 max-w-md w-full p-4 bg-white border-t z-40">
                
                <!-- Input Kode Promo (BARU) -->
                <div class="mb-3">
                    <label for="promo-code-input" class="block text-sm font-medium text-gray-700 mb-1">Kode Promo</label>
                    <div class="flex gap-2">
                        <input type="text" id="promo-code-input" placeholder="Masukkan kode" class="flex-grow w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors uppercase" />
                        <button id="apply-promo-btn" class="bg-orange-500 text-white px-4 py-2 rounded-lg font-medium text-sm hover:bg-orange-600 transition-colors">Pakai</button>
                    </div>
                    <!-- Status message untuk promo -->
                    <p id="promo-status-text" class="text-sm mt-1.5"></p>
                </div>
                
                <!-- Subtotal (BARU) -->
                <div class="flex justify-between items-center mb-2 mt-3">
                    <span class="text-gray-700 font-medium">Subtotal:</span>
                    <span id="cart-subtotal" class="text-lg font-medium text-gray-700">Rp0</span>
                </div>
                
                <!-- Baris Diskon Promo (BARU) -->
                <div id="promo-discount-row" class="hidden flex justify-between items-center mb-2">
                    <span class="text-green-600 font-medium">Diskon Promo:</span>
                    <span id="cart-promo-discount" class="text-lg font-medium text-green-600">-Rp0</span>
                </div>

                <!-- Total (Diubah) -->
                <div class="flex justify-between items-center mb-3 border-t pt-2">
                    <span class="text-gray-700 font-medium">Total:</span>
                    <span id="cart-total" class="text-2xl font-bold text-orange-600">Rp0</span>
                </div>
                
                <button id="checkout-wa-btn" class="w-full bg-green-500 text-white py-3 rounded-lg font-semibold shadow-lg hover:bg-green-600 transition-colors">
                    <i class="fa-solid fa-file-invoice mr-2"></i>
                    Lanjut ke Pengiriman
                </button>
            </footer>
        </div>

        <!-- ===== HALAMAN CHECKOUT / DATA PENGIRIMAN ===== -->
        <div id="page-checkout" class="page">
            <header class="sticky top-0 z-50 bg-white shadow px-4 py-3 flex items-center">
                <button class="navigate-btn text-xl" data-target="page-cart">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h2 class="text-lg font-semibold ml-4">Data Pengiriman</h2>
            </header>
            <main class="p-4 pb-40">
                <form id="checkout-form">
                    <div class="mb-4">
                        <label for="checkout-name" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label>
                        <input type="text" id="checkout-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" required>
                    </div>
                    <div class="mb-4">
                        <label for="checkout-wa" class="block text-sm font-medium text-gray-700 mb-1">Nomor WhatsApp</label>
                        <input type="tel" id="checkout-wa" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" placeholder="Contoh: 08123456789" required>
                    </div>
                    <div class="mb-4">
                        <label for="checkout-address" class="block text-sm font-medium text-gray-700 mb-1">Alamat Lengkap</label>
                        <textarea id="checkout-address" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" placeholder="Sertakan nama jalan, nomor rumah, RT/RW, kelurahan, kecamatan, kota/kab, dan kode pos." required></textarea>
                    </div>
                    <div class="mb-6">
                        <label for="checkout-notes" class="block text-sm font-medium text-gray-700 mb-1">Catatan (opsional)</label>
                        <textarea id="checkout-notes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" placeholder="Contoh: Pagar warna hijau"></textarea>
                    </div>
                    <!-- Error message placeholder -->
                    <p id="checkout-error" class="text-red-500 text-sm text-center mb-4"></p>
                </form>
            </main>
            
            <!-- FOOTER CHECKOUT (DIPERBARUI) -->
            <footer class="fixed bottom-16 left-1/2 -translate-x-1/2 max-w-md w-full p-4 bg-white border-t z-40">
                
                <!-- Subtotal (BARU) -->
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-700 font-medium">Subtotal:</span>
                    <span id="checkout-page-subtotal" class="text-lg font-medium text-gray-700">Rp0</span>
                </div>
                
                <!-- Baris Diskon Promo (BARU) -->
                <div id="checkout-promo-discount-row" class="hidden flex justify-between items-center mb-2">
                    <span class="text-green-600 font-medium">Diskon Promo:</span>
                    <span id="checkout-page-promo-discount" class="text-lg font-medium text-green-600">-Rp0</span>
                </div>
                
                <!-- Total (Diubah) -->
                <div class="flex justify-between items-center mb-3 border-t pt-2">
                    <span class="text-gray-700 font-medium">Total:</span>
                    <span id="checkout-page-total" class="text-2xl font-bold text-orange-600">Rp0</span>
                </div>
                
                <button type="submit" form="checkout-form" id="send-order-wa-btn" class="w-full bg-green-500 text-white py-3 rounded-lg font-semibold shadow-lg hover:bg-green-600 transition-colors">
                    <i class="fa-brands fa-whatsapp mr-2 text-xl"></i>
                    Kirim Pesanan via WhatsApp
                </button>
            </footer>
        </div>

        <!-- ===== HALAMAN LOGIN ADMIN ===== -->
        <div id="page-login" class="page">
            <header class="sticky top-0 z-50 bg-white shadow px-4 py-3">
                <h2 class="text-lg font-semibold text-center">Login Admin</h2>
            </header>
            <main class="p-6 pt-10">
                <img src="https://i.ibb.co.com/n86sQs1v/Logo-Toko-Aneka-Cemilan-Snack-Ceria-Oranye-Kuning-20251105_010226_0000.png" alt="Logo" class="w-32 mx-auto mb-6">
                <form id="login-form">
                    <div class="mb-4">
                        <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                        <input type="text" id="username" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" required>
                    </div>
                    <div class="mb-6">
                        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" required>
                    </div>
                    <button type="submit" class="w-full bg-orange-600 text-white py-3 rounded-lg font-semibold hover:bg-orange-700 transition-colors">Login</button>
                    <p id="login-error" class="text-red-500 text-sm text-center mt-4"></p>
                </form>
            </main>
        </div>

        <!-- ===== HALAMAN DASHBOARD ADMIN ===== -->
        <div id="page-admin" class="page">
            <header class="sticky top-0 z-50 bg-white shadow px-4 py-3 flex items-center justify-between">
                <h2 class="text-lg font-semibold">Admin Dashboard</h2>
                <button id="logout-btn" class="text-sm text-red-500 font-medium hover:text-red-700 transition-colors">Logout</button>
            </header>
            <main class="p-4 pb-20">
                <button id="add-new-btn" class="w-full bg-green-500 text-white py-3 rounded-lg font-semibold mb-6 shadow hover:bg-green-600 transition-colors">
                    <i class="fa-solid fa-plus mr-2"></i> Tambah Produk Baru
                </button>
                
                <!-- KELOLA KATEGORI -->
                <h3 class="font-semibold text-gray-800 mb-3 border-t pt-4 mt-6">Kelola Kategori Produk</h3>
                <div class="bg-gray-50 p-3 rounded-lg mb-6 border border-gray-200">
                    <div id="category-list-admin" class="flex flex-wrap gap-2 mb-3">
                        <!-- List kategori akan di-render di sini -->
                    </div>
                    <form id="add-category-form" class="flex gap-2">
                        <input type="text" id="new-category-name" placeholder="Nama Kategori Baru" class="flex-grow px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-500" required>
                        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors">Tambah</button>
                    </form>
                </div>
                
                <!-- KELOLA PROMO CODE (BARU) -->
                <h3 class="font-semibold text-gray-800 mb-3 border-t pt-4 mt-6">Kelola Kode Promo</h3>
                <div class="bg-gray-50 p-3 rounded-lg mb-6 border border-gray-200">
                    <div id="promo-list-admin" class="space-y-2 mb-3">
                        <!-- List promo akan di-render di sini -->
                    </div>
                    <button id="add-promo-btn" class="w-full bg-orange-500 text-white py-2 rounded-lg text-sm font-semibold hover:bg-orange-600 transition-colors">
                        <i class="fa-solid fa-plus mr-2"></i> Tambah Kode Promo
                    </button>
                </div>

                <h3 class="font-semibold text-gray-800 mb-3">Daftar Produk</h3>
                <div id="admin-product-list" class="space-y-3">
                    <!-- Daftar produk admin akan di-render di sini -->
                </div>
            </main>
        </div>

        <!-- ===== HALAMAN TAMBAH/EDIT PRODUK ===== -->
        <div id="page-edit" class="page">
            <header class="sticky top-0 z-50 bg-white shadow px-4 py-3 flex items-center">
                <button class="cancel-edit-btn text-xl">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h2 id="form-title" class="text-lg font-semibold ml-4">Tambah Produk</h2>
            </header>
            <main class="p-4 pb-20">
                <form id="product-form">
                    <!-- Hidden input untuk menyimpan ID produk saat edit -->
                    <input type="hidden" id="product-id">
                    
                    <div class="mb-4">
                        <label for="product-name" class="block text-sm font-medium text-gray-700 mb-1">Nama Produk</label>
                        <input type="text" id="product-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" required>
                    </div>
                    <!-- Kategori (Diubah menjadi SELECT) -->
                    <div class="mb-4">
                        <label for="product-category-select" class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
                        <!-- ID diganti untuk menghindari konflik -->
                        <select id="product-category-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" required>
                            <!-- Opsi akan di-render oleh JavaScript -->
                        </select>
                    </div>
                    <!-- Subtitle -->
                    <div class="mb-4">
                        <label for="product-subtitle" class="block text-sm font-medium text-gray-700 mb-1">Sub Judul / Keterangan Singkat</label>
                        <input type="text" id="product-subtitle" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" placeholder="Kripik Pisang Rasa Original Kripik pisang...">
                    </div>

                    <!-- HARGA BARU: Harga Normal (Dicoret) dan Harga Jual -->
                    <div class="mb-4" id="price-input-group">
                        <!-- Harga Normal (Hanya terlihat jika Promo Spesial dipilih) -->
                        <div id="original-price-container" class="mb-4 hidden">
                            <label for="product-original-price" class="block text-sm font-medium text-gray-700 mb-1">Harga Normal (Dicoret)</label>
                            <input type="number" id="product-original-price" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" value="0">
                        </div>
                        
                        <label for="product-price" class="block text-sm font-medium text-gray-700 mb-1">Harga Jual Saat Ini (Angka)</label>
                        <input type="number" id="product-price" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" required>
                    </div>

                    <!-- Input Rating -->
                    <div class="mb-4">
                        <label for="product-rating" class="block text-sm font-medium text-gray-700 mb-1">Rating (0.0 - 5.0)</label>
                        <input type="number" id="product-rating" step="0.1" min="0" max="5" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" required>
                    </div>
                    <!-- Input Gambar Diubah ke Textarea -->
                    <div class="mb-4">
                        <label for="product-images" class="block text-sm font-medium text-gray-700 mb-1">URL Gambar (Pisahkan dengan koma)</label>
                        <textarea id="product-images" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" placeholder="https://.../gambar1.jpg, https://.../gambar2.jpg" required></textarea>
                        <p class="text-xs text-gray-500 mt-1">Gambar pertama akan menjadi gambar utama.</p>
                    </div>
                    <div class="mb-6">
                        <label for="product-description" class="block text-sm font-medium text-gray-700 mb-1">Deskripsi</label>
                        <textarea id="product-description" rows="5" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" required></textarea>
                    </div>
                    <button type="submit" class="w-full bg-orange-600 text-white py-3 rounded-lg font-semibold hover:bg-orange-700 transition-colors">Simpan Produk</button>
                </form>
            </main>
        </div>
        
        <!-- ===== HALAMAN TAMBAH/EDIT PROMO CODE (BARU) ===== -->
        <div id="page-promo-edit" class="page">
            <header class="sticky top-0 z-50 bg-white shadow px-4 py-3 flex items-center">
                <button class="navigate-btn text-xl" data-target="page-admin">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h2 id="promo-form-title" class="text-lg font-semibold ml-4">Tambah Kode Promo</h2>
            </header>
            <main class="p-4 pb-20">
                <form id="promo-form">
                    <input type="hidden" id="promo-original-code">
                    
                    <div class="mb-4">
                        <label for="promo-code-input-edit" class="block text-sm font-medium text-gray-700 mb-1">Kode Promo</label>
                        <input type="text" id="promo-code-input-edit" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors uppercase" required>
                        <p class="text-xs text-gray-500 mt-1">Gunakan huruf kapital dan tanpa spasi.</p>
                    </div>
                    
                    <div class="mb-4">
                        <label for="promo-type-select" class="block text-sm font-medium text-gray-700 mb-1">Jenis Diskon</label>
                        <select id="promo-type-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" required>
                            <option value="percent">Persentase (%)</option>
                            <option value="fixed">Nominal (Rp)</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label for="promo-value-input" class="block text-sm font-medium text-gray-700 mb-1">Nilai Diskon</label>
                        <input type="number" id="promo-value-input" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" required>
                        <p id="promo-value-hint" class="text-xs text-gray-500 mt-1">Masukkan angka (misal: 10 untuk 10%, atau 10000 untuk Rp 10.000).</p>
                    </div>

                    <div class="mb-6">
                        <label for="promo-description-input" class="block text-sm font-medium text-gray-700 mb-1">Deskripsi/Keterangan</label>
                        <input type="text" id="promo-description-input" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors" required>
                    </div>
                    
                    <button type="submit" class="w-full bg-orange-600 text-white py-3 rounded-lg font-semibold hover:bg-orange-700 transition-colors">Simpan Kode Promo</button>
                </form>
                <p id="promo-form-error" class="text-red-500 text-sm text-center mt-4"></p>
            </main>
        </div>

        <!-- Bottom Navigation Bar -->
        <nav class="fixed bottom-0 left-1/2 -translate-x-1/2 max-w-md w-full bg-white shadow-[0_-2px_6px_rgba(0,0,0,0.06)] border-t border-gray-200 grid grid-cols-4 z-50">
            <!-- Home -->
            <button class="nav-button-style navigate-btn text-center py-3 text-gray-600" data-target="page-home" data-default-color="text-gray-600" data-active-color="text-orange-600">
                <i class="fa-solid fa-home text-2xl"></i>
            </button>
            <!-- Whitelist -->
            <button class="nav-button-style navigate-btn text-center py-3 text-gray-600" data-target="page-liked" data-default-color="text-gray-600" data-active-color="text-red-500">
                <i class="fa-solid fa-heart text-2xl"></i>
            </button>
            <!-- Keranjang -->
            <button class="nav-button-style navigate-btn text-center py-3 text-gray-600" data-target="page-cart" data-default-color="text-gray-600" data-active-color="text-orange-600">
                <i class="fa-solid fa-shopping-basket text-2xl"></i>
            </button>
            <!-- Admin (User Shield) -->
            <button class="nav-button-style navigate-btn text-center py-3 text-gray-600" data-target="page-login" data-default-color="text-gray-600" data-active-color="text-orange-600">
                <i class="fa-solid fa-user-shield text-2xl"></i>
            </button>
        </nav>
    </div>

    <!-- ===== FOOTER MODERN (SEDERHANA) ===== -->
    <footer id="main-footer" class="bg-gray-800 text-gray-300 py-8 mt-16 shadow-inner w-full">
        <div class="max-w-md mx-auto px-4">
            <!-- Logo & Slogan -->
            <div class="mb-6 text-center border-b border-gray-700 pb-4">
                <div class="flex items-center justify-center gap-2 mb-2">
                    <img src="https://i.ibb.co.com/n86sQs1v/Logo-Toko-Aneka-Cemilan-Snack-Ceria-Oranye-Kuning-20251105_010226_0000.png" alt="Kriuké Snack Logo" class="h-8 w-auto">
                    <span class="text-xl font-bold text-orange-500">Kriuké Snack</span>
                </div>
                <p class="text-sm text-gray-400">Kriuknya Beda, Rasanya Istimewa.</p>
            </div>

            <!-- Kontak & Sosial Media -->
            <div class="text-center mb-6">
                <h5 class="text-md font-semibold text-white mb-3">Hubungi Kami</h5>
                <ul class="space-y-2 text-sm max-w-xs mx-auto">
                    <li class="flex items-center justify-center gap-2">
                        <i class="fa-brands fa-whatsapp text-green-500"></i>
                        <a href="https://wa.me/6282349786916" target="_blank" class="hover:text-green-400">0823-4978-6916</a>
                    </li>
                    <li class="flex items-center justify-center gap-2">
                        <i class="fa-solid fa-envelope text-orange-500"></i>
                        <a href="mailto:kriuke@snack.id" class="hover:text-orange-500">kriuke@snack.id</a>
                    </li>
                </ul>
            </div>

            <!-- Social Media Icons -->
            <div class="flex justify-center gap-6 mt-8 border-t border-gray-700 pt-6">
                <a href="#" class="text-2xl text-gray-400 hover:text-white transition-colors" aria-label="Instagram">
                    <i class="fa-brands fa-instagram"></i>
                </a>
                <a href="#" class="text-2xl text-gray-400 hover:text-white transition-colors" aria-label="Facebook">
                    <i class="fa-brands fa-facebook"></i>
                </a>
                <a href="#" class="text-2xl text-gray-400 hover:text-white transition-colors" aria-label="Twitter">
                    <i class="fa-brands fa-twitter"></i>
                </a>
                <a href="#" class="text-2xl text-gray-400 hover:text-white transition-colors" aria-label="TikTok">
                    <i class="fa-brands fa-tiktok"></i>
                </a>
            </div>

            <!-- Copyright -->
            <div class="text-center text-xs text-gray-500 mt-8">
                &copy; 2025 Kriuké Snack. Hak Cipta Dilindungi.
            </div>
        </div>
    </footer>


    <!-- Custom Modal for Delete Confirmation -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-sm w-full">
            <h3 class="text-lg font-semibold mb-4">Konfirmasi Hapus</h3>
            <p class="text-gray-600 mb-6">Apakah Anda yakin ingin menghapus produk ini?</p>
            <div class="flex justify-end gap-3">
                <button id="cancel-delete" class="px-4 py-2 bg-gray-200 rounded-lg font-medium hover:bg-gray-300 transition-colors">Batal</button>
                <button id="confirm-delete" class="px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-colors">Hapus</button>
            </div>
        </div>
    </div>
    
    <!-- Custom Modal for Delete Category Confirmation -->
    <div id="delete-category-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-sm w-full">
            <h3 class="text-lg font-semibold mb-4">Konfirmasi Hapus Kategori</h3>
            <p class="text-gray-600 mb-6">Apakah Anda yakin ingin menghapus kategori: <span id="category-to-delete-name" class="font-bold text-orange-600"></span>?</p>
            <div class="flex justify-end gap-3">
                <button id="cancel-category-delete" class="px-4 py-2 bg-gray-200 rounded-lg font-medium hover:bg-gray-300 transition-colors">Batal</button>
                <button id="confirm-category-delete" class="px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-colors">Hapus</button>
            </div>
        </div>
    </div>

    <!-- Custom Modal for Delete Promo Confirmation (BARU) -->
    <div id="delete-promo-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-sm w-full">
            <h3 class="text-lg font-semibold mb-4">Konfirmasi Hapus Promo</h3>
            <p class="text-gray-600 mb-6">Apakah Anda yakin ingin menghapus kode promo: <span id="promo-to-delete-name" class="font-bold text-orange-600"></span>?</p>
            <div class="flex justify-end gap-3">
                <button id="cancel-promo-delete" class="px-4 py-2 bg-gray-200 rounded-lg font-medium hover:bg-gray-300 transition-colors">Batal</button>
                <button id="confirm-promo-delete" class="px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-colors">Hapus</button>
            </div>
        </div>
    </div>
    
    <!-- Off-Canvas Menu -->
    <div id="off-canvas-menu" class="fixed inset-0 z-[100] hidden">
        <!-- Overlay -->
        <div id="menu-overlay" class="absolute inset-0 bg-black bg-opacity-50 transition-opacity opacity-0"></div>
        
        <!-- Drawer -->
        <div id="menu-drawer" class="absolute right-0 top-0 bottom-0 w-3/4 max-w-[300px] bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out p-6 overflow-y-auto">
            <div class="flex justify-between items-center pb-4 border-b border-gray-200 mb-6">
                <h3 class="text-xl font-bold text-orange-600">Menu Utama</h3>
                <button id="menu-close-btn" class="text-2xl text-gray-700 hover:text-red-500">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>

            <div class="space-y-3">
                <a href="#" class="menu-link navigate-btn block text-lg font-medium text-gray-700 hover:text-orange-600 transition-colors" data-target="page-home">
                    <i class="fa-solid fa-home mr-3 w-5"></i> Home
                </a>
                <a href="#" class="menu-link navigate-btn block text-lg font-medium text-gray-700 hover:text-red-500 transition-colors" data-target="page-liked">
                    <i class="fa-solid fa-heart mr-3 w-5"></i> Whitelist Favorit
                </a>
                <a href="#" class="menu-link navigate-btn block text-lg font-medium text-gray-700 hover:text-orange-600 transition-colors" data-target="page-cart">
                    <i class="fa-solid fa-shopping-basket mr-3 w-5"></i> Keranjang
                </a>
                
                <div class="pt-4 border-t border-gray-100"></div>

                <!-- Dummy Links -->
                <a href="#" class="menu-link block text-base text-gray-600 hover:text-gray-800 transition-colors">
                    <i class="fa-solid fa-user-circle mr-3 w-5"></i> Profil Saya
                </a>
                <a href="#" class="menu-link block text-base text-gray-600 hover:text-gray-800 transition-colors">
                    <i class="fa-solid fa-gear mr-3 w-5"></i> Pengaturan
                </a>
                <a href="#" class="menu-link block text-base text-gray-600 hover:text-gray-800 transition-colors">
                    <i class="fa-solid fa-question-circle mr-3 w-5"></i> Bantuan
                </a>
                
                <div class="pt-4 border-t border-gray-100"></div>

                <a href="#" class="menu-link navigate-btn block text-lg font-medium text-gray-700 hover:text-orange-600 transition-colors" data-target="page-login">
                    <i class="fa-solid fa-user-shield mr-3 w-5"></i> Admin Login
                </a>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // === STATE & KONSTANTA ===
            let products = [];
            let cart = [];
            let categories = [];
            let isLoggedIn = false;
            let activeCategory = 'Semua';
            let likedProducts = JSON.parse(localStorage.getItem('kriuke_liked') || '[]');
            const ADMIN_USER = 'arjune';
            const ADMIN_PASS = 'kriuke123';
            const WHATSAPP_NUMBER = '6282349786916';
            let productToDeleteId = null;
            let categoryToDelete = null;
            
            // --- Logika Kode Promo ---
            let appliedPromo = null; // Menyimpan *kunci* promo yang diterapkan
            let promoCodes = {}; // Akan diinisialisasi dari localStorage
            let promoCodeToDelete = null;
            // ---------------------------------

            // === REFERENSI DOM ===
            const pages = document.querySelectorAll('.page');
            const navButtons = document.querySelectorAll('.nav-button-style');
            const productGrid = document.getElementById('product-grid');
            const detailContent = document.getElementById('detail-content');
            const categoryFilterContainer = document.getElementById('category-filter-container');
            const loginForm = document.getElementById('login-form');
            const loginError = document.getElementById('login-error');
            const logoutBtn = document.getElementById('logout-btn');
            const adminProductList = document.getElementById('admin-product-list');
            const addNewBtn = document.getElementById('add-new-btn');
            const productForm = document.getElementById('product-form');
            const formTitle = document.getElementById('form-title');
            const productIdInput = document.getElementById('product-id');
            const productNameInput = document.getElementById('product-name');
            const productCategorySelect = document.getElementById('product-category-select'); 
            const productSubtitleInput = document.getElementById('product-subtitle');
            
            // Referensi HARGA
            const originalPriceContainer = document.getElementById('original-price-container'); // BARU
            const productOriginalPriceInput = document.getElementById('product-original-price'); // BARU
            const productPriceInput = document.getElementById('product-price');
            
            const productRatingInput = document.getElementById('product-rating');
            const productImagesInput = document.getElementById('product-images');
            const productDescInput = document.getElementById('product-description');
            const cancelEditBtns = document.querySelectorAll('.cancel-edit-btn');
            
            // Referensi Keranjang
            const cartIconBtn = document.getElementById('cart-icon-btn');
            const cartCountBadge = document.getElementById('cart-count-badge');
            const cartItemsContainer = document.getElementById('cart-items-container');
            const checkoutWaBtn = document.getElementById('checkout-wa-btn');
            const toastNotification = document.getElementById('toast-notification');

            // --- Referensi Promo & Total Keranjang ---
            const promoCodeInput = document.getElementById('promo-code-input');
            const applyPromoBtn = document.getElementById('apply-promo-btn');
            const promoStatusText = document.getElementById('promo-status-text');
            const cartSubtotalEl = document.getElementById('cart-subtotal');
            const promoDiscountRow = document.getElementById('promo-discount-row');
            const cartPromoDiscountEl = document.getElementById('cart-promo-discount');
            const cartTotalEl = document.getElementById('cart-total');
            // ----------------------------------------------------

            // Referensi Halaman Checkout
            const checkoutForm = document.getElementById('checkout-form');
            // --- Referensi Total Checkout ---
            const checkoutPageSubtotalEl = document.getElementById('checkout-page-subtotal');
            const checkoutPromoDiscountRow = document.getElementById('checkout-promo-discount-row');
            const checkoutPagePromoDiscountEl = document.getElementById('checkout-page-promo-discount');
            const checkoutPageTotalEl = document.getElementById('checkout-page-total');
            // ------------------------------------------
            const checkoutError = document.getElementById('checkout-error');

            // Referensi Halaman Liked
            const likedItemsContainer = document.getElementById('liked-items-container');
            
            // Referensi Menu
            const menuToggleBtn = document.getElementById('menu-toggle-btn');
            const offCanvasMenu = document.getElementById('off-canvas-menu');
            const menuOverlay = document.getElementById('menu-overlay');
            const menuDrawer = document.getElementById('menu-drawer');
            const menuCloseBtn = document.getElementById('menu-close-btn');

            // Referensi Admin Kategori
            const addCategoryForm = document.getElementById('add-category-form');
            const newCategoryNameInput = document.getElementById('new-category-name');
            const categoryListAdmin = document.getElementById('category-list-admin');
            const deleteCategoryModal = document.getElementById('delete-category-modal');
            const categoryToDeleteNameEl = document.getElementById('category-to-delete-name');
            const cancelCategoryDeleteBtn = document.getElementById('cancel-category-delete');
            const confirmCategoryDeleteBtn = document.getElementById('confirm-category-delete');

            // Referensi Modal Hapus Produk
            const deleteModal = document.getElementById('delete-modal');
            const cancelDeleteBtn = document.getElementById('cancel-delete');
            const confirmDeleteBtn = document.getElementById('confirm-delete');
            
            // --- Referensi Admin Promo Code ---
            const addPromoBtn = document.getElementById('add-promo-btn');
            const promoForm = document.getElementById('promo-form');
            const promoFormTitle = document.getElementById('promo-form-title');
            const promoOriginalCodeInput = document.getElementById('promo-original-code');
            const promoCodeInputEdit = document.getElementById('promo-code-input-edit');
            const promoTypeSelect = document.getElementById('promo-type-select');
            const promoValueInput = document.getElementById('promo-value-input');
            const promoDescriptionInput = document.getElementById('promo-description-input');
            const promoFormError = document.getElementById('promo-form-error');
            const promoListAdmin = document.getElementById('promo-list-admin');
            const promoValueHint = document.getElementById('promo-value-hint');
            
            // Referensi Modal Hapus Promo
            const deletePromoModal = document.getElementById('delete-promo-modal');
            const promoToDeleteNameEl = document.getElementById('promo-to-delete-name');
            const cancelPromoDeleteBtn = document.getElementById('cancel-promo-delete');
            const confirmPromoDeleteBtn = document.getElementById('confirm-promo-delete');


            // === FUNGSI UTILITAS ===

            function formatRupiah(angka) {
                return new Intl.NumberFormat('id-ID').format(Math.round(angka));
            }

            function showToast(message) {
                toastNotification.textContent = message;
                toastNotification.classList.remove('opacity-0');
                setTimeout(() => {
                    toastNotification.classList.add('opacity-0');
                }, 2000);
            }

            // Fungsi Share utama
            let isSharing = false; 

            async function handleShare(productName) {
                if (isSharing) return;

                const url = window.location.href;
                const text = `Cek produk keren ini: ${productName} dari Kriuké Snack! Kriuknya Beda, Rasanya Istimewa.`;

                if (navigator.share) {
                    isSharing = true; 
                    try {
                        await navigator.share({
                            title: `Kriuké Snack - ${productName}`,
                            text: text,
                            url: url,
                        });
                    } catch (error) {
                        console.error('Error sharing:', error);
                    } finally {
                        isSharing = false;
                    }
                } else {
                    // Fallback for copying to clipboard
                    const textToCopy = `${text} ${url}`;
                    try {
                        await navigator.clipboard.writeText(textToCopy);
                        showToast('Link berhasil disalin ke clipboard!');
                    } catch (err) {
                         // Older execCommand fallback
                        const dummy = document.createElement('textarea');
                        document.body.appendChild(dummy);
                        dummy.value = textToCopy;
                        dummy.select();
                        document.execCommand('copy');
                        document.body.removeChild(dummy);
                        showToast('Link berhasil disalin ke clipboard!');
                    }
                }
            }
            
            function handleShareFromCard(id, name) {
                handleShare(name);
            }
            
            // FUNGSI BARU: Langsung buat pesan WA untuk produk tunggal di kartu
            function handleBuySingleWa(id) {
                const product = products.find(p => p.id === id);
                if (!product) return;

                const message = encodeURIComponent(
                    `Halo Kriuké Snack, saya ingin memesan 1x *${product.name.toUpperCase()}* (Rp${formatRupiah(product.price)}). Mohon konfirmasi pesanan saya. Terima kasih!`
                );
                
                const waUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${message}`;
                window.open(waUrl, '_blank');
            }


            // Fungsi inti penambahan ke keranjang
            function handleCartAddition(id, quantity) {
                const product = products.find(p => p.id === id);
                if (!product) return;
                
                const existingItem = cart.find(item => item.id === id);
                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    cart.push({ id: id, quantity: quantity });
                }

                saveCart();
                updateCartBadge();
                // Perbarui total jika sedang di halaman keranjang/checkout
                const activePageId = document.querySelector('.page.active').id;
                if (activePageId === 'page-cart') {
                    renderCartPage();
                } else if (activePageId === 'page-checkout') {
                    renderCheckoutPage();
                }
                showToast(`${product.name.toUpperCase()} ditambahkan ke keranjang!`);
            }
            
            // FUNGSI MENU TOGGLE
            function toggleMenu(show) {
                if (show) {
                    offCanvasMenu.classList.remove('hidden');
                    setTimeout(() => {
                        menuOverlay.classList.remove('opacity-0');
                        menuDrawer.classList.remove('translate-x-full');
                    }, 10);
                } else {
                    menuOverlay.classList.add('opacity-0');
                    menuDrawer.classList.add('translate-x-full');
                    setTimeout(() => {
                        offCanvasMenu.classList.add('hidden');
                    }, 300); 
                }
            }


            // FUNGSI NAVIGASI
            function navigate(pageId) {
                pages.forEach(page => page.classList.remove('active'));
                
                const targetPage = document.getElementById(pageId);
                if (targetPage) {
                    targetPage.classList.add('active');
                    window.scrollTo(0, 0);
                }
                
                if (pageId === 'page-cart') {
                    renderCartPage();
                } else if (pageId === 'page-checkout') {
                    renderCheckoutPage();
                } else if (pageId === 'page-liked') {
                    renderLikedPage();
                } else if (pageId === 'page-admin') {
                    renderAdminCategoryList();
                    renderAdminPromoList(); 
                    renderAdminList();
                }

                // Update status tombol navigasi bawah
                navButtons.forEach(btn => {
                    const target = btn.dataset.target;
                    const isActivePage = (target === pageId) || 
                                         (target === 'page-login' && (pageId === 'page-admin' || pageId === 'page-edit' || pageId === 'page-promo-edit')) ||
                                         (target === 'page-cart' && pageId === 'page-checkout'); 

                    // Hapus semua warna aktif
                    btn.classList.remove('text-orange-600', 'text-gray-600', 'text-red-500');
                    if (isActivePage) {
                        // Terapkan warna aktif spesifik
                        const activeColor = btn.dataset.activeColor || 'text-orange-600';
                        btn.classList.add(activeColor);
                    } else {
                        // Terapkan warna default
                        const defaultColor = btn.dataset.defaultColor || 'text-gray-600';
                        btn.classList.add(defaultColor);
                    }
                });

                // Update status ikon keranjang di header
                if (pageId === 'page-cart' || pageId === 'page-checkout') {
                    cartIconBtn.classList.add('text-orange-600');
                    cartIconBtn.classList.remove('text-gray-700');
                } else {
                    cartIconBtn.classList.remove('text-orange-600');
                    cartIconBtn.classList.add('text-gray-700');
                }
            }
            
            // FUNGSI UNTUK MERENDER BINTANG RATING
            function renderStars(rating) {
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 !== 0;
                let starsHtml = '';
                
                for (let i = 0; i < 5; i++) {
                    if (i < fullStars) {
                        starsHtml += '<i class="fa-solid fa-star text-yellow-400"></i>';
                    } else if (i === fullStars && hasHalfStar) {
                        starsHtml += '<i class="fa-solid fa-star-half-stroke text-yellow-400"></i>';
                    } else {
                        starsHtml += '<i class="fa-regular fa-star text-gray-300"></i>';
                    }
                }
                return starsHtml;
            }

            // FUNGSI DETAIL PRODUK
            function showProductDetail(id) {
                const product = products.find(p => p.id === id);
                if (!product) return;
                
                // Ambil rata-rata rating (jika ada ulasan)
                const totalReviews = product.reviews ? product.reviews.length : 0;
                const averageRating = product.reviews 
                    ? (product.reviews.reduce((sum, r) => sum + r.rating, 0) / totalReviews).toFixed(1)
                    : product.rating; // Gunakan rating default jika tidak ada ulasan

                // --- GENERATE ULASAN ---
                let reviewSummaryHtml = '';
                let reviewsListHtml = '';
                
                if (totalReviews > 0) {
                    const ratingCounts = [0, 0, 0, 0, 0]; // Index 0=1 bintang, 4=5 bintang
                    product.reviews.forEach(r => {
                        // Kumpulkan hanya rating 4 dan 5 untuk ringkasan visual
                        if (r.rating >= 4) {
                            ratingCounts[r.rating - 1]++;
                        }
                    });
                    
                    const percent5 = ((ratingCounts[4] / totalReviews) * 100).toFixed(0);
                    const percent4 = ((ratingCounts[3] / totalReviews) * 100).toFixed(0);

                    reviewSummaryHtml = `
                        <div class="mt-6 border p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-bold text-gray-800 mb-3">Ringkasan Rating (${totalReviews} Ulasan)</h4>
                            <div class="space-y-1 text-sm">
                                <!-- Bar Rating 5 Bintang -->
                                <div class="flex items-center gap-2">
                                    <span class="font-medium w-4">5</span>
                                    ${renderStars(5)}
                                    <div class="flex-grow bg-gray-200 h-2.5 rounded-full overflow-hidden">
                                        <div class="bg-green-500 h-full" style="width: ${percent5}%;"></div>
                                    </div>
                                    <span class="w-10 text-right text-gray-600">${percent5}%</span>
                                </div>
                                <!-- Bar Rating 4 Bintang -->
                                <div class="flex items-center gap-2">
                                    <span class="font-medium w-4">4</span>
                                    ${renderStars(4)}
                                    <div class="flex-grow bg-gray-200 h-2.5 rounded-full overflow-hidden">
                                        <div class="bg-green-400 h-full" style="width: ${percent4}%;"></div>
                                    </div>
                                    <span class="w-10 text-right text-gray-600">${percent4}%</span>
                                </div>
                            </div>
                        </div>
                    `;

                    // Generate list ulasan
                    reviewsListHtml = `
                        <h3 class="text-xl font-semibold text-gray-800 mt-8 mb-4 border-t pt-4">Semua Ulasan Pelanggan</h3>
                        <div class="space-y-6">
                            ${product.reviews.map(review => `
                                <div class="p-3 border-b border-gray-100">
                                    <div class="flex items-center justify-between">
                                        <p class="font-medium text-gray-800">${review.user}</p>
                                        <div class="text-sm text-gray-500">${review.date}</div>
                                    </div>
                                    <div class="flex items-center text-sm mb-2">
                                        <div class="text-lg mr-2">${renderStars(review.rating)}</div>
                                        <span class="text-yellow-400 font-bold">${review.rating.toFixed(1)}</span>
                                    </div>
                                    <p class="text-gray-700 text-sm">${review.comment}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;

                } else {
                    reviewsListHtml = `
                        <div class="text-center py-8 border-t mt-8">
                            <i class="fa-regular fa-comment-dots text-5xl text-gray-300 mb-3"></i>
                            <p class="text-gray-500">Belum ada ulasan untuk produk ini.</p>
                        </div>
                    `;
                }

                // --- AKHIR GENERATE ULASAN ---


                let thumbnailHTML = '';
                product.images.forEach((img, index) => {
                    thumbnailHTML += `
                        <img src="${img}" alt="thumbnail ${index + 1}" class="thumbnail-img w-16 h-16 object-cover rounded-md cursor-pointer border-2 ${index === 0 ? 'border-orange-500' : 'border-gray-200'}" data-img-src="${img}" onerror="this.src='https://placehold.co/64x64/FFECB3/000000?text=Error'">
                    `;
                });

                const actionButtonsHTML = `
                    <div class="flex items-center gap-2 mt-6 p-4 border-t border-gray-200 -mx-4">
                        <button id="detail-share-btn" data-id="${product.id}" data-name="${product.name}" class="bg-white text-gray-600 w-12 h-12 rounded-lg flex items-center justify-center text-xl shadow-sm hover:bg-gray-100 transition-colors border border-gray-300">
                            <i class="fa-solid fa-share-alt"></i>
                        </button>
                        <button id="detail-add-to-cart-btn" data-id="${product.id}" class="bg-orange-100 text-orange-600 w-12 h-12 rounded-lg flex items-center justify-center text-xl shadow-sm hover:bg-orange-200 transition-colors border border-orange-600">
                            <i class="fa-solid fa-shopping-cart"></i>
                        </button>
                        <button id="detail-buy-wa-btn" data-id="${product.id}" data-name="${product.name}" class="flex-grow bg-green-500 text-white h-12 px-6 rounded-lg flex items-center justify-center font-semibold shadow-lg hover:bg-green-600 transition-colors">
                            <i class="fa-brands fa-whatsapp mr-2 text-xl"></i>
                            Beli via WhatsApp
                        </button>
                    </div>
                `;

                detailContent.innerHTML = `
                    <img id="main-product-image" src="${product.images[0]}" alt="${product.name}" class="w-full h-80 object-cover" onerror="this.src='https://placehold.co/400x256/FFECB3/000000?text=Error'">
                    
                    <div class="flex gap-2 p-4 overflow-x-auto">
                        ${thumbnailHTML}
                    </div>

                    <div class="p-4 pt-0">
                        <h2 class="text-2xl font-bold text-gray-900 capitalize">${product.name}</h2>
                        <div class="flex items-center justify-between my-2">
                            <p class="text-3xl font-bold text-red-600">Rp${formatRupiah(product.price)}</p>
                            <div class="flex items-center gap-1 text-lg">
                                ${renderStars(product.rating)}
                                <span class="font-bold text-gray-800">${product.rating}</span>
                                <span class="text-sm text-gray-500 ml-2">(${totalReviews} ulasan)</span>
                            </div>
                        </div>
                        <h3 class="text-lg font-semibold mt-6 mb-2">Deskripsi Produk</h3>
                        <p class="text-gray-700 whitespace-pre-wrap mb-6">${product.description}</p>
                        
                        ${reviewSummaryHtml}

                        ${reviewsListHtml}

                        <h4 class="font-semibold text-gray-800 mb-2 mt-5 text-sm">Beli di E-commerce:</h4>
                        <div class="grid grid-cols-4 gap-3 text-center mb-6"> 
                            <a href="#" class="block p-3 bg-gray-50 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                                <img src="https://i.ibb.co.com/399C2Fwj/social-media.png" alt="TikTok Shop" class="w-8 h-8 mx-auto rounded">
                                <span class="text-xs font-medium mt-1 block">TikTok</span>
                            </a>
                            <a href="#" class="block p-3 bg-gray-50 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                                <img src="https://i.ibb.co.com/Vp32s5hK/shopee-seeklogo.png" alt="Shopee" class="w-8 h-8 mx-auto rounded">
                                <span class="text-xs font-medium mt-1 block">Shopee</span>
                            </a>
                            <a href="#" class="block p-3 bg-gray-50 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                                <img src="https://i.ibb.co.com/fYb3fDrz/tokopedia-seeklogo.png" alt="Tokopedia" class="w-8 h-8 mx-auto rounded">
                                <span class="text-xs font-medium mt-1 block">Tokopedia</span>
                            </a>
                            <a href="#" class="block p-3 bg-gray-50 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                                <img src="https://i.ibb.co.com/0VBH5vB9/lazada-seeklogo.png" alt="Lazada" class="w-8 h-8 mx-auto rounded">
                                <span class="text-xs font-medium mt-1 block">Lazada</span>
                            </a>
                        </div>
                        
                        ${actionButtonsHTML}
                        
                    </div>
                `;
                
                // Add event listeners
                detailContent.querySelectorAll('.thumbnail-img').forEach(thumb => {
                    thumb.addEventListener('click', (e) => {
                        const newSrc = e.currentTarget.dataset.imgSrc;
                        document.getElementById('main-product-image').src = newSrc;
                        detailContent.querySelectorAll('.thumbnail-img').forEach(t => t.classList.replace('border-orange-500', 'border-gray-200'));
                        e.currentTarget.classList.replace('border-gray-200', 'border-orange-500');
                    });
                });
                
                document.getElementById('detail-share-btn').addEventListener('click', (e) => {
                    const name = e.currentTarget.dataset.name;
                    handleShare(name);
                });

                document.getElementById('detail-add-to-cart-btn').addEventListener('click', (e) => {
                    const id = e.currentTarget.dataset.id;
                    handleCartAddition(id, 1);
                });

                document.getElementById('detail-buy-wa-btn').addEventListener('click', handleBuyViaWa);
                
                navigate('page-detail');
            }
            
            function handleBuyViaWa(e) {
                const id = e.currentTarget.dataset.id;
                const name = e.currentTarget.dataset.name;
                const product = products.find(p => p.id === id);

                if (!product) return;

                const message = encodeURIComponent(
                    `Halo Kriuké Snack, saya ingin memesan 1x *${name.toUpperCase()}* (Rp${formatRupiah(product.price)}). Mohon konfirmasi pesanan saya. Terima kasih!`
                );
                
                const waUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${message}`;
                window.open(waUrl, '_blank');
            }
            
            // === FUNGSI LIKE/DISLIKE ===
            function saveLikedProducts() {
                localStorage.setItem('kriuke_liked', JSON.stringify(likedProducts));
            }

            function handleToggleLike(id) {
                const index = likedProducts.indexOf(id);
                const buttons = document.querySelectorAll(`.like-btn[data-id="${id}"] i`);
                
                if (index > -1) {
                    likedProducts.splice(index, 1);
                    buttons.forEach(button => {
                         button.classList.remove('fa-solid', 'text-red-500');
                         button.classList.add('fa-regular', 'text-gray-300');
                    });
                    showToast('Produk dihapus dari favorit.');
                } else {
                    likedProducts.push(id);
                    buttons.forEach(button => {
                        button.classList.remove('fa-regular', 'text-gray-300');
                        button.classList.add('fa-solid', 'text-red-500');
                    });
                    showToast('Produk ditambahkan ke favorit!');
                }
                saveLikedProducts();
                
                if (document.getElementById('page-liked').classList.contains('active')) {
                    renderLikedPage();
                }
            }
            
            function renderLikedPage() {
                likedItemsContainer.innerHTML = '';
                // Filter produk yang datanya masih ada
                const likedProductsData = products.filter(p => likedProducts.includes(p.id));

                if (likedProductsData.length === 0) {
                    likedItemsContainer.innerHTML = `
                        <div class="flex flex-col items-center justify-center text-center col-span-2 mt-10 p-4">
                            <i class="fa-solid fa-heart-crack text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-lg font-semibold text-gray-700">Daftar Favorit Anda Kosong</h3>
                            <p class="text-gray-500 mb-6">Ayo, temukan kripik yang Anda suka!</p>
                            <button class="navigate-btn bg-orange-600 text-white px-6 py-2 rounded-full font-semibold shadow hover:bg-orange-700" data-target="page-home">
                                Kembali ke Home
                            </button>
                        </div>
                    `;
                    return;
                }

                likedProductsData.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'bg-white rounded-lg shadow-md overflow-hidden';
                    
                    productCard.innerHTML = `
                        <div class="relative cursor-pointer" data-id="${product.id}">
                            <img src="${product.images[0]}" alt="${product.name}" class="w-full aspect-square object-cover" 
                                onerror="this.src='https://placehold.co/100x100/FEE300/000000?text=Kriuké'">
                            
                            <button data-id="${product.id}" class="like-btn absolute top-2 right-2 p-2 bg-white rounded-full shadow-md hover:scale-105 transition-transform z-10">
                                <i class="fa-solid fa-heart text-red-500 text-xl"></i>
                            </button>
                        </div>
                        <div class="p-3">
                            <p class="text-xs ${product.category === 'Promo Spesial' ? 'text-red-500 font-bold' : 'text-gray-500'} mb-1 capitalize">${product.category}</p>
                            <h4 class="text-base font-semibold text-gray-800 capitalize">${product.name}</h4>
                            <p class="text-xl font-bold text-red-600 mb-3">Rp${formatRupiah(product.price)}</p>

                            <div class="flex gap-2">
                                <button data-id="${product.id}" class="add-to-cart-liked-btn w-full p-2 bg-orange-600 text-white rounded-lg shadow-md hover:bg-orange-700 transition-colors flex items-center justify-center text-sm">
                                    <i class="fa-solid fa-shopping-cart mr-2"></i> Tambah ke Keranjang
                                </button>
                            </div>
                        </div>
                    `;

                    productCard.querySelector('.relative').addEventListener('click', () => showProductDetail(product.id));

                    productCard.querySelector('.unlike-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        handleToggleLike(product.id);
                    });
                    
                    productCard.querySelector('.add-to-cart-liked-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        handleCartAddition(product.id, 1);
                    });

                    likedItemsContainer.appendChild(productCard);
                });
            }

            // === FUNGSI RENDER HOME ===
            function renderHomeProducts(filterCategory = 'Semua') {
                productGrid.innerHTML = '';

                let filteredProducts = products.filter(p => {
                    const searchInput = document.getElementById('search-input').value.toLowerCase().trim();
                    const matchesCategory = (filterCategory === 'Semua') ? true : p.category === filterCategory;
                    const matchesSearch = p.name.toLowerCase().includes(searchInput) || 
                                          p.subtitle.toLowerCase().includes(searchInput) || 
                                          p.description.toLowerCase().includes(searchInput);
                    return matchesCategory && matchesSearch;
                });
                
                if (filteredProducts.length === 0) {
                    const searchInput = document.getElementById('search-input').value.trim();
                    const message = searchInput
                        ? `Tidak ada produk ditemukan untuk: "${searchInput}" di kategori ${filterCategory}.`
                        : `Tidak ada produk untuk kategori ini.`;

                    productGrid.innerHTML = `<p class="text-gray-500 col-span-2 text-center py-10 px-4">${message}</p>`;
                    return;
                }
                
                filteredProducts.forEach(product => {
                    const isLiked = likedProducts.includes(product.id);
                    const likeIconClass = isLiked ? 'fa-solid text-red-500' : 'fa-regular text-gray-300';
                    const totalSold = Math.floor(Math.random() * 500) + 100; // Contoh data acak
                    
                    // Logic untuk menampilkan harga dicoret
                    const showOriginalPrice = product.originalPrice && product.originalPrice > product.price;
                    const originalPriceHTML = showOriginalPrice
                        ? `<span class="text-sm text-gray-500 line-through mr-2">Rp${formatRupiah(product.originalPrice)}</span>`
                        : '';


                    const productCard = document.createElement('div');
                    productCard.className = 'bg-white rounded-lg shadow-md overflow-hidden transform transition-transform duration-150 hover:shadow-lg';
                    
                    productCard.innerHTML = `
                        <div class="relative cursor-pointer" data-id="${product.id}">
                            <img src="${product.images[0]}" alt="${product.name}" class="w-full aspect-square object-cover" 
                                onerror="this.src='https://placehold.co/100x100/FEE300/000000?text=Kriuké'">
                            
                            <button data-id="${product.id}" class="like-btn absolute top-2 right-2 p-2 bg-white rounded-full shadow-md hover:scale-105 transition-transform z-10">
                                <i class="${likeIconClass} fa-heart text-xl"></i>
                            </button>
                        </div>
                        <div class="p-3">
                            <!-- BARIS KATEGORI, RATING, DAN TERJUAL -->
                            <div class="flex items-center justify-between mb-1">
                                <p class="text-xs ${product.category === 'Promo Spesial' ? 'text-red-500 font-bold' : 'text-gray-500'} capitalize">${product.category}</p>
                                <div class="flex items-center gap-1 text-xs">
                                    <i class="fa-solid fa-star text-yellow-400"></i>
                                    <span class="font-medium text-gray-700">${product.rating}</span>
                                    <span class="text-gray-500 ml-1">(${formatRupiah(totalSold)} terjual)</span>
                                </div>
                            </div>
                            
                            <h4 class="text-base font-semibold text-gray-800 capitalize">${product.name}</h4>
                            
                            <p class="text-sm text-gray-600 mb-2 whitespace-nowrap overflow-hidden text-ellipsis">${product.subtitle || product.description.substring(0, 30) + '...'}</p>
                            
                            <!-- BARIS HARGA: HARGA NORMAL DICORET DAN HARGA JUAL -->
                            <div class="flex items-baseline mb-3">
                                ${originalPriceHTML}
                                <p class="text-xl font-bold text-red-600">Rp${formatRupiah(product.price)}</p>
                            </div>

                            <!-- BARIS TOMBOL AKSI: DIRAPIKAN MENJADI 3 BAGIAN SAMA BESAR -->
                            <div class="flex gap-2">
                                <button data-id="${product.id}" data-name="${product.name}" class="share-card-btn w-1/3 p-2 bg-white border border-gray-200 text-gray-600 rounded-lg shadow-sm hover:bg-gray-100 transition-colors flex items-center justify-center text-xl">
                                    <i class="fa-solid fa-share-alt"></i>
                                </button>
                                <button data-id="${product.id}" class="add-to-cart-card-btn w-1/3 p-2 bg-orange-600 text-white rounded-lg shadow-md hover:bg-orange-700 transition-colors flex items-center justify-center text-xl">
                                    <i class="fa-solid fa-shopping-cart"></i>
                                </button>
                                <button data-id="${product.id}" class="buy-single-wa-btn w-1/3 p-2 bg-green-500 text-white rounded-lg shadow-md hover:bg-green-600 transition-colors flex items-center justify-center text-xl">
                                    <i class="fa-brands fa-whatsapp"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    productCard.querySelector('.relative').addEventListener('click', () => showProductDetail(product.id));

                    productCard.querySelector('.like-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        handleToggleLike(product.id);
                    });

                    productCard.querySelector('.share-card-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        handleShareFromCard(product.id, product.name);
                    });
                    
                    productCard.querySelector('.add-to-cart-card-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        handleCartAddition(product.id, 1);
                    });
                    
                    // Event listener untuk tombol WhatsApp baru
                    productCard.querySelector('.buy-single-wa-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        handleBuySingleWa(product.id);
                    });

                    productGrid.appendChild(productCard);
                });
            }

            function renderCategoryFilters() {
                const productCategories = products.map(p => p.category).filter(c => c); // Ambil semua kategori dari produk
                const allCategories = ['Semua', ...categories]; // Gunakan state categories + 'Semua'
                const uniqueCategories = [...new Set(allCategories)]; // Pastikan unik
                
                categoryFilterContainer.innerHTML = ''; 

                uniqueCategories.forEach(category => {
                    const button = document.createElement('button');
                    button.textContent = category;
                    button.dataset.category = category;
                    
                    let styleClass;
                    if (category === activeCategory) {
                        styleClass = 'bg-orange-600 text-white border-orange-600 shadow-md';
                    } else {
                        styleClass = 'bg-white text-gray-700 border-gray-300 shadow-sm';
                    }

                    button.className = `${styleClass} px-4 py-2 rounded-full text-sm font-medium border transition-colors whitespace-nowrap hover:shadow-md hover:border-orange-500`;
                    
                    button.addEventListener('click', () => {
                        activeCategory = category;
                        renderCategoryFilters();
                        renderHomeProducts(activeCategory);
                    });
                    
                    categoryFilterContainer.appendChild(button);
                });
            }


            // === FUNGSI KATEGORI ADMIN ===

            function loadCategories() {
                const storedCategories = localStorage.getItem('kriuke_categories');
                if (storedCategories) {
                    categories = JSON.parse(storedCategories);
                } else {
                    categories = ['Keripik Pisang', 'Promo Spesial', 'Manis', 'Gurih', 'Pedas', 'Lainnya'];
                    saveCategories();
                }
            }
            
            function saveCategories() {
                localStorage.setItem('kriuke_categories', JSON.stringify(categories));
            }

            function handleAddCategory(e) {
                e.preventDefault();
                const newCategory = newCategoryNameInput.value.trim();
                
                if (newCategory && !categories.includes(newCategory)) {
                    categories.push(newCategory);
                    saveCategories();
                    renderAdminCategoryList();
                    renderCategoryFilters();
                    newCategoryNameInput.value = '';
                    showToast(`Kategori "${newCategory}" berhasil ditambahkan.`);
                } else if (categories.includes(newCategory)) {
                    showToast(`Kategori "${newCategory}" sudah ada!`);
                }
            }
            
            // FUNGSI UNTUK MENAMPILKAN MODAL HAPUS KATEGORI
            function showCategoryDeleteConfirmation(category) {
                // Kategori default yang dilindungi
                const defaultCategories = ['Semua', 'Keripik Pisang', 'Promo Spesial', 'Manis', 'Gurih', 'Pedas', 'Lainnya'];
                if (defaultCategories.includes(category)) {
                     showToast(`Kategori default "${category}" tidak dapat dihapus.`);
                     return;
                }
                categoryToDelete = category;
                categoryToDeleteNameEl.textContent = category;
                deleteCategoryModal.classList.remove('hidden');
            }

            // FUNGSI UNTUK MELAKUKAN HAPUS KATEGORI
            function handleDeleteCategory() {
                if (!categoryToDelete) return;
                
                const deletedCategory = categoryToDelete;
                categories = categories.filter(c => c !== deletedCategory);
                saveCategories();

                // Pindahkan produk yang kehilangan kategori ke kategori 'Lainnya'
                products.forEach(p => {
                    if (p.category === deletedCategory) {
                        p.category = 'Lainnya';
                    }
                });
                saveProducts();
                
                // Render ulang semua yang terkait
                renderAdminCategoryList();
                renderCategoryFilters();
                renderAdminList();
                deleteCategoryModal.classList.add('hidden');
                showToast(`Kategori "${deletedCategory}" berhasil dihapus.`);
                categoryToDelete = null;
            }
            
            function renderAdminCategoryList() {
                categoryListAdmin.innerHTML = '';
                
                if (categories.length === 0) {
                    categoryListAdmin.innerHTML = '<p class="text-gray-600 text-sm">Tidak ada kategori. Tambahkan di bawah.</p>';
                    return;
                }

                categories.forEach(category => {
                    const isDefault = ['Keripik Pisang', 'Promo Spesial', 'Manis', 'Gurih', 'Pedas', 'Lainnya'].includes(category);
                    const item = document.createElement('div');
                    item.className = 'flex items-center bg-white border rounded-full pl-3 pr-2 py-1 shadow-sm';
                    item.innerHTML = `
                        <span class="text-sm font-medium text-gray-700">${category}</span>
                        ${!isDefault ? `
                        <button data-category="${category}" class="delete-category-btn ml-2 p-1 text-red-500 hover:text-red-700">
                            <i class="fa-solid fa-times text-xs"></i>
                        </button>` : ''}
                    `;
                    categoryListAdmin.appendChild(item);
                });

                document.querySelectorAll('.delete-category-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const category = e.currentTarget.dataset.category;
                        showCategoryDeleteConfirmation(category);
                    });
                });
            }
            
            function renderCategoryOptions(selectedCategory = '') {
                productCategorySelect.innerHTML = '';
                
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    if (category === selectedCategory) {
                        option.selected = true;
                    }
                    productCategorySelect.appendChild(option);
                });
                
                // Panggil toggle visibility setelah options di-render
                toggleOriginalPriceInput(selectedCategory);
            }


            // === FUNGSI DATA & ADMIN PRODUK ===
            function loadProducts() {
                const storedProducts = localStorage.getItem('kriuke_products');
                if (storedProducts) {
                    products = JSON.parse(storedProducts);
                } else {
                    // Data awal (p2 ditambahkan originalPrice)
                    products = [
                        {
                            id: 'p1',
                            name: 'kripik pisang rasa original',
                            subtitle: 'Gurih alami, kriuknya beda.',
                            price: 25000,
                            rating: 4.8,
                            category: 'Keripik Pisang',
                            images: [
                                'https://placehold.co/300x300/FEE300/000000?text=Original+Pack',
                                'https://placehold.co/300x300/8D6E63/FFFFFF?text=Original+Detail'
                            ],
                            description: 'Kripik pisang renyah dengan rasa asli pisang yang gurih alami. Cocok untuk semua kalangan dan camilan harian Anda. Kriuknya beda, rasanya istimewa!',
                            isLiked: false,
                            reviews: [
                                { user: 'Ani', rating: 5, date: '10/05/2025', comment: 'Rasa original yang selalu bikin kangen! Kriuknya pas, tidak terlalu manis.' },
                                { user: 'Budi', rating: 4, date: '12/05/2025', comment: 'Kualitas oke, packing aman. Hanya saja pengiriman agak lambat.' }
                            ]
                        },
                        {
                            id: 'p2',
                            name: 'kriuke rasa coklat',
                            subtitle: 'Promo Spesial: lumer coklat premium.',
                            price: 20000, 
                            originalPrice: 28000, // Harga normal ditambahkan
                            rating: 4.7,
                            category: 'Promo Spesial', 
                            images: [
                                'https://placehold.co/300x300/795548/FFFFFF?text=Coklat+Pack',
                                'https://placehold.co/300x300/795548/FFFFFF?text=Coklat+Detail'
                            ],
                            description: 'Promo Spesial! Kripik pisang renyah dibalut dengan coklat premium yang lumer di mulut. Kriuknya beda, rasanya istimewa!',
                            isLiked: false,
                            reviews: [
                                { user: 'Citra', rating: 5, date: '01/06/2025', comment: 'Coklatnya tebal! Harga promo sangat worth it. Anak-anak suka sekali.' },
                                { user: 'Dedi', rating: 4, date: '05/06/2025', comment: 'Enak, tapi sedikit terlalu manis untuk saya. Overall bagus!' }
                            ]
                        },
                        {
                            id: 'p3',
                            name: 'kripik pisang rasa balado',
                            subtitle: 'Pedas manis bumbu balado khas.',
                            price: 18000,
                            rating: 4.5,
                            category: 'Pedas', 
                            images: [
                                'https://placehold.co/300x300/F44336/FFFFFF?text=Balado+Pack'
                            ],
                            description: 'Sensasi pedas manis bumbu balado khas yang bikin ketagihan. Dibuat dari cabai pilihan dan bumbu rempah Indonesia. Berani coba?',
                            isLiked: false,
                            reviews: [
                                { user: 'Eka', rating: 5, date: '15/05/2025', comment: 'Pedasnya pas dan bumbunya melimpah! Bikin nagih, harus coba rasa ini.' }
                            ]
                        },
                        {
                            id: 'p4',
                            name: 'kriuke rasa pedas manis',
                            subtitle: 'Manis gula aren dan sensasi pedas hangat.',
                            price: 19000,
                            rating: 4.9,
                            category: 'Manis', 
                            images: [
                                'https://placehold.co/300x300/D32F2F/FFFFFF?text=Pedas+Manis+Pack'
                            ],
                            description: 'Perpaduan sempurna antara rasa manis gula aren dan sensasi pedas yang hangat. Rasa yang pasti disukai semua orang!',
                            isLiked: false,
                            reviews: [
                                { user: 'Fani', rating: 5, date: '20/05/2025', comment: 'Gilaa ini enak banget, perpaduan manis dan pedasnya seimbang.' },
                                { user: 'Gatot', rating: 5, date: '22/05/2025', comment: 'Selalu beli yang ini. Terbaikkkk.' }
                            ]
                        },
                        {
                            id: 'p5',
                            name: 'kripik pisang rasa matcha',
                            subtitle: 'Untuk pecinta teh hijau Jepang.',
                            price: 22000,
                            rating: 4.6,
                            category: 'Manis',
                            images: [
                                'https://placehold.co/300x300/4CAF50/FFFFFF?text=Matcha+Pack',
                                'https://placehold.co/300x300/4CAF50/FFFFFF?text=Matcha+Detail'
                            ],
                            description: 'Bagi pecinta teh hijau! Kriuké dengan bubuk matcha asli Jepang, memberikan rasa manis pahit yang unik dan menenangkan.',
                            isLiked: false,
                            reviews: [] // Contoh produk tanpa ulasan
                        },
                        {
                            id: 'p6',
                            name: 'kriuke rasa sapi panggang',
                            subtitle: 'Gurihnya bumbu sapi panggang premium.',
                            price: 21000,
                            rating: 4.3,
                            category: 'Gurih',
                            images: [
                                'https://placehold.co/300x300/6D4C41/FFFFFF?text=Sapi+Panggang+Pack',
                                'https://placehold.co/300x300/6D4C41/FFFFFF?text=Sapi+Panggang+Detail'
                            ],
                            description: 'Nikmati sensasi gurihnya bumbu sapi panggang premium dalam setiap gigitan kriuk. Cocok untuk Anda yang suka rasa asin dan gurih.',
                            isLiked: false,
                            reviews: [
                                { user: 'Hana', rating: 4, date: '01/07/2025', comment: 'Rasa gurih yang mantap! Cocok buat teman nonton bola.' }
                            ]
                        }
                    ];
                    saveProducts();
                }
            }
            
            function saveProducts() {
                localStorage.setItem('kriuke_products', JSON.stringify(products));
            }

            function handleLogin(e) {
                e.preventDefault();
                const username = loginForm.username.value;
                const password = loginForm.password.value;

                if (username === ADMIN_USER && password === ADMIN_PASS) {
                    isLoggedIn = true;
                    loginError.textContent = '';
                    loginForm.reset();
                    renderAdminCategoryList();
                    renderAdminPromoList(); 
                    renderAdminList();
                    navigate('page-admin');
                } else {
                    isLoggedIn = false;
                    loginError.textContent = 'Username atau password salah!';
                }
            }

            function handleLogout() {
                isLoggedIn = false;
                navigate('page-login');
            }
            
            // FUNGSI BARU: Mengatur visibilitas input Harga Normal
            function toggleOriginalPriceInput(category) {
                if (category === 'Promo Spesial') {
                    originalPriceContainer.classList.remove('hidden');
                    productOriginalPriceInput.setAttribute('required', 'required');
                } else {
                    originalPriceContainer.classList.add('hidden');
                    productOriginalPriceInput.removeAttribute('required');
                    productOriginalPriceInput.value = ''; // Clear value if not promo
                }
            }

            function showAddForm() {
                formTitle.textContent = 'Tambah Produk Baru';
                productForm.reset();
                productIdInput.value = '';
                productSubtitleInput.value = '';
                productImagesInput.value = ''; 
                productOriginalPriceInput.value = ''; // Reset price
                
                const defaultCategory = categories.includes('Keripik Pisang') ? 'Keripik Pisang' : '';
                renderCategoryOptions(defaultCategory); // Ini akan memanggil toggleOriginalPriceInput
                
                navigate('page-edit');
            }

            function showEditForm(id) {
                const product = products.find(p => p.id === id);
                if (!product) return;

                formTitle.textContent = 'Edit Produk';
                productIdInput.value = product.id;
                productNameInput.value = product.name;
                productSubtitleInput.value = product.subtitle || '';
                productPriceInput.value = product.price;
                productRatingInput.value = product.rating;
                productImagesInput.value = product.images.join(', ');
                productDescInput.value = product.description;
                
                // Set Original Price Input (hanya jika ada)
                productOriginalPriceInput.value = product.originalPrice || '';
                
                renderCategoryOptions(product.category); // Ini akan memanggil toggleOriginalPriceInput
                
                navigate('page-edit');
            }

            function handleFormSubmit(e) {
                e.preventDefault();
                const id = productIdInput.value;
                const newRating = parseFloat(productRatingInput.value);
                const selectedCategory = productCategorySelect.value;
                const price = parseInt(productPriceInput.value);
                
                let originalPrice = null;
                if (selectedCategory === 'Promo Spesial' && originalPriceContainer.classList.contains('hidden') === false) {
                    originalPrice = parseInt(productOriginalPriceInput.value);
                    if (originalPrice <= price) {
                        showToast('Harga Normal harus lebih tinggi dari Harga Jual untuk promo!');
                        return;
                    }
                }
                
                if (isNaN(newRating) || newRating < 0 || newRating > 5) {
                    showToast('Rating harus berupa angka antara 0.0 dan 5.0.');
                    return;
                }

                if (!selectedCategory) {
                    showToast('Pilih kategori produk.');
                    return;
                }

                const productData = {
                    name: productNameInput.value.toLowerCase(),
                    category: selectedCategory,
                    subtitle: productSubtitleInput.value.trim() || '',
                    price: price,
                    originalPrice: originalPrice, // Simpan harga asli
                    rating: newRating,
                    images: productImagesInput.value.split(',').map(url => url.trim()).filter(url => url),
                    description: productDescInput.value,
                    // Pertahankan ulasan yang sudah ada saat mengedit
                    reviews: id ? (products.find(p => p.id === id)?.reviews || []) : [] 
                };

                if (productData.images.length === 0) {
                    showToast('Masukkan setidaknya satu URL gambar.');
                    return;
                }

                if (id) {
                    // Edit produk
                    const index = products.findIndex(p => p.id === id);
                    products[index] = { ...products[index], ...productData };
                } else {
                    // Tambah produk baru
                    productData.id = 'p' + (new Date().getTime());
                    products.push(productData);
                }

                saveProducts();
                renderHomeProducts(activeCategory);
                renderCategoryFilters();
                renderAdminList();
                showToast('Produk berhasil disimpan!');
                navigate('page-admin');
            }

            function showDeleteConfirmation(id) {
                productToDeleteId = id;
                deleteModal.classList.remove('hidden');
            }

            function handleDelete() {
                if (!productToDeleteId) return;
                const deletedProductId = productToDeleteId;

                products = products.filter(p => p.id !== deletedProductId);
                saveProducts();
                
                // Hapus dari keranjang dan favorit
                cart = cart.filter(item => item.id !== deletedProductId);
                saveCart();
                likedProducts = likedProducts.filter(id => id !== deletedProductId);
                saveLikedProducts();

                updateCartBadge();
                
                renderHomeProducts(activeCategory);
                renderCategoryFilters();
                renderAdminList();
                deleteModal.classList.add('hidden');
                productToDeleteId = null;
                showToast('Produk berhasil dihapus.');
                navigate('page-admin');
            }
            
            function renderAdminList() {
                adminProductList.innerHTML = '';
                if (products.length === 0) {
                    adminProductList.innerHTML = '<p class="text-gray-500 text-center">Belum ada produk.</p>';
                    return;
                }
                // Urutkan berdasarkan ID (terbaru di atas)
                [...products].sort((a, b) => b.id.localeCompare(a.id)).forEach(product => {
                    const item = document.createElement('div');
                    item.className = 'flex items-center justify-between bg-white p-3 rounded-lg shadow-sm border';
                    item.innerHTML = `
                        <div class="flex items-center gap-3">
                            <img src="${product.images[0]}" alt="${product.name}" class="w-12 h-12 object-cover rounded" onerror="this.src='https://placehold.co/48x48/FFECB3/000000?text=Error'">
                            <div class="flex-grow">
                                <h4 class="font-medium capitalize">${product.name}</h4>
                                <div class="flex items-center gap-2 mt-1 flex-wrap">
                                    <p class="text-sm text-gray-600">Rp${formatRupiah(product.price)}</p>
                                    ${product.originalPrice ? `<span class="text-xs text-red-500 bg-red-100 px-2 py-0.5 rounded-full">DISKON</span>` : ''}
                                    <span class="text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full">${product.category}</span>
                                    <span class="flex items-center gap-1 text-xs text-yellow-600 bg-yellow-50 px-2 py-0.5 rounded-full">
                                        <i class="fa-solid fa-star fa-xs"></i>
                                        ${product.rating}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button class="edit-btn p-2 text-blue-500 hover:text-blue-700 transition-colors" data-id="${product.id}">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </button>
                            <button class="delete-btn p-2 text-red-500 hover:text-red-700 transition-colors" data-id="${product.id}">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    `;
                    adminProductList.appendChild(item);
                });

                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        showEditForm(id);
                    });
                });

                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        showDeleteConfirmation(id);
                    });
                });
            }
            
            // === FUNGSI ADMIN PROMO CODE ===

            function loadPromoCodes() {
                const storedPromoCodes = localStorage.getItem('kriuke_promo_codes');
                if (storedPromoCodes) {
                    promoCodes = JSON.parse(storedPromoCodes);
                } else {
                    // Data awal default
                    promoCodes = {
                        'KRIUKHEMAT': { type: 'percent', value: 10, description: 'Diskon 10% untuk total belanja' },
                        'DISKON10K': { type: 'fixed', value: 10000, description: 'Potongan harga Rp 10.000' },
                        'FREEONGKIR': { type: 'fixed', value: 5000, description: 'Potongan biaya kirim (simulasi)' }
                    };
                    savePromoCodes();
                }
            }

            function savePromoCodes() {
                localStorage.setItem('kriuke_promo_codes', JSON.stringify(promoCodes));
            }

            function updatePromoValueHint() {
                const type = promoTypeSelect.value;
                if (type === 'percent') {
                    promoValueHint.textContent = 'Masukkan persentase (misal: 10 untuk 10%).';
                } else {
                    promoValueHint.textContent = 'Masukkan nominal Rupiah (misal: 10000 untuk Rp 10.000).';
                }
            }
            
            function showPromoForm(code = null) {
                promoForm.reset();
                promoOriginalCodeInput.value = '';
                promoFormTitle.textContent = 'Tambah Kode Promo Baru';
                promoFormError.textContent = '';
                promoTypeSelect.addEventListener('change', updatePromoValueHint);
                updatePromoValueHint(); // Set default hint

                if (code) {
                    const promo = promoCodes[code];
                    if (!promo) return;
                    
                    promoFormTitle.textContent = `Edit Kode Promo: ${code}`;
                    promoOriginalCodeInput.value = code;
                    promoCodeInputEdit.value = code;
                    promoTypeSelect.value = promo.type;
                    promoValueInput.value = promo.value;
                    promoDescriptionInput.value = promo.description;
                    updatePromoValueHint();
                }

                navigate('page-promo-edit');
            }

            function handlePromoFormSubmit(e) {
                e.preventDefault();
                promoFormError.textContent = '';

                const originalCode = promoOriginalCodeInput.value.toUpperCase();
                const newCode = promoCodeInputEdit.value.trim().toUpperCase();
                const newType = promoTypeSelect.value;
                const newValue = parseInt(promoValueInput.value);
                const newDescription = promoDescriptionInput.value.trim();

                if (!newCode || !newType || isNaN(newValue) || newValue <= 0 || !newDescription) {
                    promoFormError.textContent = 'Mohon lengkapi semua data dengan benar.';
                    return;
                }
                
                // Validasi duplikasi kode (kecuali jika sedang mengedit kodenya sendiri)
                if (newCode !== originalCode && promoCodes.hasOwnProperty(newCode)) {
                    promoFormError.textContent = `Kode promo "${newCode}" sudah ada!`;
                    return;
                }
                
                // Hapus kode lama jika kode diubah
                if (originalCode && originalCode !== newCode) {
                    delete promoCodes[originalCode];
                    // Jika promo yang diubah sedang diterapkan di keranjang, hapus penerapannya
                    if (appliedPromo === originalCode) {
                        appliedPromo = null;
                        promoCodeInput.value = '';
                        promoStatusText.textContent = '';
                    }
                } else if (originalCode && newCode === originalCode) {
                    // Edit tapi kode sama, lakukan update di tempat
                } else if (!originalCode) {
                    // Tambah baru
                } else {
                    return;
                }
                
                // Simpan atau update kode baru
                promoCodes[newCode] = {
                    type: newType,
                    value: newValue,
                    description: newDescription
                };

                savePromoCodes();
                showToast(`Kode promo "${newCode}" berhasil disimpan.`);
                renderAdminPromoList();
                // Jika sedang di halaman keranjang, panggil update total
                if (document.getElementById('page-cart').classList.contains('active')) {
                    updateCartTotalsUI();
                }
                navigate('page-admin');
            }
            
            function renderAdminPromoList() {
                promoListAdmin.innerHTML = '';
                const codes = Object.keys(promoCodes);
                
                if (codes.length === 0) {
                    promoListAdmin.innerHTML = '<p class="text-gray-600 text-sm">Belum ada kode promo. Tambahkan di atas.</p>';
                    return;
                }

                codes.forEach(code => {
                    const promo = promoCodes[code];
                    const isDefault = ['KRIUKHEMAT', 'DISKON10K', 'FREEONGKIR'].includes(code);
                    
                    const item = document.createElement('div');
                    item.className = 'flex items-center justify-between bg-white p-3 rounded-lg shadow-sm border border-orange-200';
                    item.innerHTML = `
                        <div class="flex-grow">
                            <h4 class="font-bold text-orange-600">${code}</h4>
                            <p class="text-sm text-gray-700">${promo.description}</p>
                            <span class="text-xs text-blue-500 font-medium">
                                ${promo.type === 'percent' ? `${promo.value}%` : `Rp${formatRupiah(promo.value)}`}
                                ${isDefault ? ' (Default)' : ''}
                            </span>
                        </div>
                        <div class="flex gap-2">
                            <button class="edit-promo-btn p-2 text-blue-500 hover:text-blue-700 transition-colors" data-code="${code}" aria-label="Edit Promo">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </button>
                            <button class="delete-promo-btn p-2 text-red-500 hover:text-red-700 transition-colors ${isDefault ? 'opacity-50 cursor-not-allowed' : ''}" data-code="${code}" ${isDefault ? 'disabled' : ''} aria-label="Hapus Promo">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    `;
                    promoListAdmin.appendChild(item);
                });
                
                // Add event listeners for edit and delete buttons
                document.querySelectorAll('.edit-promo-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        showPromoForm(e.currentTarget.dataset.code);
                    });
                });

                document.querySelectorAll('.delete-promo-btn:not([disabled])').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        showPromoDeleteConfirmation(e.currentTarget.dataset.code);
                    });
                });
            }

            function showPromoDeleteConfirmation(code) {
                if (['KRIUKHEMAT', 'DISKON10K', 'FREEONGKIR'].includes(code)) {
                    showToast(`Kode promo default "${code}" tidak dapat dihapus.`);
                    return;
                }
                promoCodeToDelete = code;
                promoToDeleteNameEl.textContent = code;
                deletePromoModal.classList.remove('hidden');
            }

            function handleDeletePromo() {
                if (!promoCodeToDelete) return;

                if (appliedPromo === promoCodeToDelete) {
                    appliedPromo = null; // Hapus promo yang sedang diterapkan jika dihapus
                    promoCodeInput.value = '';
                    promoStatusText.textContent = '';
                    if (document.getElementById('page-cart').classList.contains('active')) {
                        updateCartTotalsUI();
                    }
                }

                delete promoCodes[promoCodeToDelete];
                savePromoCodes();
                
                renderAdminPromoList();
                deletePromoModal.classList.add('hidden');
                showToast(`Kode promo "${promoCodeToDelete}" berhasil dihapus.`);
                promoCodeToDelete = null;
            }

            // === FUNGSI KERANJANG & PROMO ===

            function loadCart() {
                const storedCart = localStorage.getItem('kriuke_cart');
                if (storedCart) {
                    cart = JSON.parse(storedCart);
                }
                updateCartBadge();
            }

            function saveCart() {
                localStorage.setItem('kriuke_cart', JSON.stringify(cart));
            }

            function updateCartBadge() {
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                if (totalItems > 0) {
                    cartCountBadge.textContent = totalItems;
                    cartCountBadge.classList.remove('opacity-0');
                } else {
                    cartCountBadge.textContent = '0';
                    cartCountBadge.classList.add('opacity-0');
                }
            }
            
            // Menghitung subtotal, diskon, dan total
            function calculateTotals() {
                let subtotal = 0;
                cart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (product) {
                        subtotal += product.price * item.quantity;
                    }
                });

                let discount = 0;
                let promoDetails = null;
                // Menggunakan promoCodes state yang sudah diisi dari localStorage
                if (appliedPromo && promoCodes[appliedPromo]) { 
                    promoDetails = promoCodes[appliedPromo];
                    if (promoDetails.type === 'percent') {
                        discount = (subtotal * promoDetails.value) / 100;
                    } else if (promoDetails.type === 'fixed') {
                        discount = promoDetails.value;
                    }
                    // Batasi diskon maksimal sebesar subtotal
                    if (discount > subtotal) {
                        discount = subtotal;
                    }
                }

                const total = subtotal - discount;
                
                return { subtotal, discount, total, promoDetails };
            }

            // Memperbarui UI total di footer keranjang dan checkout
            function updateCartTotalsUI() {
                const { subtotal, discount, total } = calculateTotals();

                // 1. Perbarui Halaman Keranjang
                cartSubtotalEl.textContent = `Rp${formatRupiah(subtotal)}`;
                cartTotalEl.textContent = `Rp${formatRupiah(total)}`;

                if (discount > 0) {
                    cartPromoDiscountEl.textContent = `-Rp${formatRupiah(discount)}`;
                    promoDiscountRow.classList.remove('hidden');
                } else {
                    promoDiscountRow.classList.add('hidden');
                }
            }
            
            // Logika saat tombol "Pakai" promo diklik
            function handleApplyPromo() {
                const code = promoCodeInput.value.trim().toUpperCase();
                
                if (!code) {
                    appliedPromo = null;
                    promoStatusText.textContent = 'Kode promo dihapus.';
                    promoStatusText.className = 'text-sm mt-1.5 text-red-500';
                    updateCartTotalsUI();
                    return;
                }

                if (promoCodes[code]) { // Cek dari state promoCodes yang baru
                    appliedPromo = code;
                    promoStatusText.textContent = `Kode "${code}" berhasil diterapkan! ${promoCodes[code].description}.`;
                    promoStatusText.className = 'text-sm mt-1.5 text-green-600';
                    promoCodeInput.value = code; // Tampilkan kode yang diterapkan
                    updateCartTotalsUI();
                } else {
                    appliedPromo = null;
                    promoStatusText.textContent = 'Kode promo tidak valid.';
                    promoStatusText.className = 'text-sm mt-1.5 text-red-500';
                    updateCartTotalsUI(); // Hitung ulang tanpa diskon
                }
            }

            function renderCartPage() {
                cartItemsContainer.innerHTML = '';
                
                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = `
                        <div class="flex flex-col items-center justify-center text-center mt-10 p-4">
                            <i class="fa-solid fa-cart-arrow-down text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-lg font-semibold text-gray-700">Keranjang Anda Kosong</h3>
                            <p class="text-gray-500 mb-6">Ayo, cari kripik favoritmu!</p>
                            <button class="navigate-btn bg-orange-600 text-white px-6 py-2 rounded-full font-semibold shadow hover:bg-orange-700" data-target="page-home">
                                Mulai Belanja
                            </button>
                        </div>
                    `;
                    // Reset footer keranjang saat kosong
                    cartSubtotalEl.textContent = 'Rp0';
                    cartTotalEl.textContent = 'Rp0';
                    promoDiscountRow.classList.add('hidden');
                    promoStatusText.textContent = '';
                    promoCodeInput.value = '';
                    appliedPromo = null;
                    
                    checkoutWaBtn.disabled = true;
                    checkoutWaBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                    checkoutWaBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                    return;
                }
                
                checkoutWaBtn.disabled = false;
                checkoutWaBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    checkoutWaBtn.classList.add('bg-green-500', 'hover:bg-green-600');

                cart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (!product) return;

                    const itemTotal = product.price * item.quantity;

                    const itemEl = document.createElement('div');
                    itemEl.className = 'flex items-center gap-3 bg-white p-3 rounded-lg shadow-sm border mb-3';
                    itemEl.innerHTML = `
                        <img src="${product.images[0]}" alt="${product.name}" class="w-16 h-16 object-cover rounded" onerror="this.src='https://placehold.co/64x64/FFECB3/000000?text=Error'">
                        <div class="flex-grow">
                            <h4 class="font-medium capitalize">${product.name}</h4>
                            <p class="text-sm text-gray-600">Harga Satuan: Rp${formatRupiah(product.price)}</p>
                            <p class="text-sm font-semibold text-orange-600">Subtotal Item: Rp${formatRupiah(itemTotal)}</p>
                        </div>
                        <div class="flex flex-col items-center gap-1">
                            <div class="flex items-center border rounded-lg">
                                <button class="cart-quantity-btn px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded-l-lg" data-id="${product.id}" data-change="-1" aria-label="Kurangi kuantitas">-</button>
                                <span class="px-2 text-sm">${item.quantity}</span>
                                <button class="cart-quantity-btn px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded-r-lg" data-id="${product.id}" data-change="1" aria-label="Tambah kuantitas">+</button>
                            </div>
                            <button class="cart-remove-btn text-xs font-medium text-red-500 hover:underline mt-1" data-id="${product.id}">Hapus</button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(itemEl);
                });

                // Panggil fungsi pembaruan total di akhir
                updateCartTotalsUI();

                // Add event listeners untuk tombol di keranjang
                document.querySelectorAll('.cart-quantity-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        const change = parseInt(e.currentTarget.dataset.change);
                        handleCartQuantityChange(id, change);
                    });
                });

                document.querySelectorAll('.cart-remove-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        handleCartRemove(id);
                    });
                });
            }

            function handleCartQuantityChange(id, change) {
                const item = cart.find(item => item.id === id);
                if (item) {
                    item.quantity += change;
                    if (item.quantity <= 0) {
                        handleCartRemove(id); // Ini akan memanggil renderCartPage
                    } else {
                        saveCart();
                        updateCartBadge();
                        renderCartPage(); // Render ulang untuk item & total
                    }
                }
            }

            function handleCartRemove(id) {
                cart = cart.filter(item => item.id !== id);
                saveCart();
                updateCartBadge();
                renderCartPage(); // Render ulang
            }

            // FUNGSI CHECKOUT
            function renderCheckoutPage() {
                if (cart.length === 0) {
                    navigate('page-cart');
                    return;
                }
                
                const { subtotal, discount, total, promoDetails } = calculateTotals();
                
                // Perbarui UI footer checkout
                checkoutPageSubtotalEl.textContent = `Rp${formatRupiah(subtotal)}`;
                checkoutPageTotalEl.textContent = `Rp${formatRupiah(total)}`;

                if (discount > 0) {
                    checkoutPagePromoDiscountEl.textContent = `-Rp${formatRupiah(discount)}`;
                    checkoutPromoDiscountRow.classList.remove('hidden');
                } else {
                    checkoutPromoDiscountRow.classList.add('hidden');
                }
                
                checkoutError.textContent = '';
            }

            // Pesan WA menyertakan info diskon
            function handleSendOrder(e) {
                e.preventDefault();
                checkoutError.textContent = '';

                const nama = document.getElementById('checkout-name').value.trim();
                const wa = document.getElementById('checkout-wa').value.trim();
                const alamat = document.getElementById('checkout-address').value.trim();
                const catatan = document.getElementById('checkout-notes').value.trim();

                if (!nama || !wa || !alamat) {
                    checkoutError.textContent = 'Mohon lengkapi Nama, Nomor WhatsApp, dan Alamat Lengkap.';
                    return;
                }

                if (cart.length === 0) {
                    checkoutError.textContent = 'Keranjang Anda kosong.';
                    return;
                }

                // Ambil total dari fungsi kalkulasi
                const { subtotal, discount, total, promoDetails } = calculateTotals();

                let message = `Halo Kriuké Snack, saya mau pesan:\n\n`;
                message += `--- *Data Pengiriman* ---\n`;
                message += `Nama: *${nama}*\n`;
                message += `No. WhatsApp: *${wa}*\n`;
                message += `Alamat: *${alamat}*\n`;
                if (catatan) {
                    message += `Catatan: *${catatan}*\n`;
                }
                message += `\n--- *Detail Pesanan* ---\n`;
                
                cart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (product) {
                        message += `*${product.name.toUpperCase()}*\n`;
                        message += `Jumlah: ${item.quantity} pcs\n`;
                        message += `Subtotal Item: Rp${formatRupiah(product.price * item.quantity)}\n\n`;
                    }
                });

                // Tambahkan Ringkasan Total, Subtotal, dan Diskon
                message += `*RINGKASAN HARGA*\n`;
                message += `Subtotal: Rp${formatRupiah(subtotal)}\n`;
                if (discount > 0 && appliedPromo && promoDetails) {
                    let discountString = promoDetails.type === 'percent' ? ` (${promoDetails.value}%)` : '';
                    message += `Diskon (${appliedPromo}${discountString}): -Rp${formatRupiah(discount)}\n`;
                }
                message += `*Total Pesanan: Rp${formatRupiah(total)}*\n\n`;
                
                message += "Mohon konfirmasi pesanan saya. Terima kasih!";

                const encodedMessage = encodeURIComponent(message);
                const waUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`;
                
                window.open(waUrl, '_blank');

                // Kosongkan keranjang & promo setelah order dikirim
                cart = [];
                appliedPromo = null;
                promoCodeInput.value = '';
                promoStatusText.textContent = '';
                saveCart();
                updateCartBadge();
                checkoutForm.reset();
                
                navigate('page-home');
                showToast('Pesanan Anda sedang diproses!');
            }


            // === FUNGSI SLIDER PROMO (BARU) ===
            function startPromoSlider() {
                const sliderContainer = document.getElementById('promo-slider-container');
                if (!sliderContainer) return; // Keluar jika slider tidak ada di halaman

                const slides = sliderContainer.querySelectorAll('.promo-slide');
                if (slides.length <= 1) return; // Tidak perlu slider jika hanya 1 gambar atau tidak ada

                let currentSlideIndex = 0;

                setInterval(() => {
                    const nextSlideIndex = (currentSlideIndex + 1) % slides.length;

                    // Fade out slide saat ini
                    slides[currentSlideIndex].classList.replace('opacity-100', 'opacity-0');
                    // Fade in slide berikutnya
                    slides[nextSlideIndex].classList.replace('opacity-0', 'opacity-100');
                    
                    currentSlideIndex = nextSlideIndex;
                }, 3000); // Ganti slide setiap 3 detik
            }


            // === INISIALISASI & EVENT LISTENER ===
            
            // Event listener untuk tombol Menu Toggle
            menuToggleBtn.addEventListener('click', () => toggleMenu(true));
            menuCloseBtn.addEventListener('click', () => toggleMenu(false));
            menuOverlay.addEventListener('click', () => toggleMenu(false));
            
            // Event listener untuk form tambah kategori
            addCategoryForm.addEventListener('submit', handleAddCategory);
            // Event listener untuk modal hapus kategori
            cancelCategoryDeleteBtn.addEventListener('click', () => deleteCategoryModal.classList.add('hidden'));
            confirmCategoryDeleteBtn.addEventListener('click', handleDeleteCategory); 
            
            // Event listener untuk promo code
            addPromoBtn.addEventListener('click', () => showPromoForm());
            promoForm.addEventListener('submit', handlePromoFormSubmit);
            cancelPromoDeleteBtn.addEventListener('click', () => deletePromoModal.classList.add('hidden'));
            confirmPromoDeleteBtn.addEventListener('click', handleDeletePromo);

            // Listener untuk mengubah visibilitas Harga Normal
            productCategorySelect.addEventListener('change', (e) => {
                toggleOriginalPriceInput(e.target.value);
            });

            // Search Input Listener
            document.getElementById('search-input').addEventListener('input', () => {
                renderHomeProducts(activeCategory);
            });

            // Navigasi (Menggunakan Event Delegation)
            document.body.addEventListener('click', (e) => {
                const button = e.target.closest('.navigate-btn');
                if (button) {
                    const target = button.dataset.target;
                    
                    // Handle menu close and navigation
                    if (offCanvasMenu.contains(button) && target) {
                        toggleMenu(false);
                        setTimeout(() => {
                            if (target === 'page-admin' || target === 'page-edit' || target === 'page-promo-edit' || target === 'page-login') {
                                navigate(isLoggedIn ? 'page-admin' : 'page-login');
                            } else {
                                navigate(target);
                            }
                        }, 50);
                        return;
                    }

                    // Logika navigasi normal
                    if (target === 'page-admin' || target === 'page-edit' || target === 'page-promo-edit' || target === 'page-login') {
                        navigate(isLoggedIn ? 'page-admin' : 'page-login');
                    } else {
                        navigate(target);
                    }
                }
            });

            // Admin
            loginForm.addEventListener('submit', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            addNewBtn.addEventListener('click', showAddForm);
            productForm.addEventListener('submit', handleFormSubmit);
            cancelEditBtns.forEach(btn => {
                btn.addEventListener('click', () => navigate('page-admin'));
            });

            // Delete Modal Produk
            cancelDeleteBtn.addEventListener('click', () => deleteModal.classList.add('hidden'));
            confirmDeleteBtn.addEventListener('click', handleDelete);
            
            // Tombol "Lanjut ke Pengiriman"
            checkoutWaBtn.addEventListener('click', () => {
                navigate('page-checkout');
            });
            // Tombol "Kirim Pesanan" (Form Checkout)
            checkoutForm.addEventListener('submit', handleSendOrder);
            
            // --- Event Listener Tombol Promo ---
            applyPromoBtn.addEventListener('click', handleApplyPromo);
            promoCodeInput.addEventListener('focus', () => {
                promoStatusText.textContent = ''; // Hapus status saat fokus
                promoStatusText.classList.remove('text-red-500', 'text-green-600');
            });
            // ------------------------------------------

            // Load data awal dan render UI
            loadCategories();
            loadPromoCodes(); 
            loadProducts();
            loadCart(); 
            renderCategoryFilters();
            renderHomeProducts();
            startPromoSlider(); // Panggil fungsi slider (BARU)
            navigate('page-home'); // Pastikan halaman awal adalah home
        });
    </script>
</body>
</html>
